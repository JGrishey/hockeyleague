<%= render 'games/carousel', recent_games: @recent_games, league: @league, season: @season %>

<div class="card mt-3">
        <div class="card-header text-center">
            <%= @league.name %> - Current Season (<%= link_to @season.title, league_season_path(@league, @season), method: :get %>)
        </div>
        <div class="card-body text-center">
            Welcome to the <%= @league.name %>. We are currently in <%= @season.title %>.
        </div>
        <% if !current_user.seasons_signed_up.include?(@season) && @season.current %>
            <div class="card-footer text-center text-muted">
                <%= link_to "Sign up", signup_league_season_path(@league, @season) %>
            </div>
        <% end %>
    </div>
</div>

<div class="container mt-4 text-center">
    <nav class="navbar navbar-white bg-white navbar-expand-lg rounded" style="background-color: #fff;">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#leagueNav" aria-controls="#leagueNav" aria-expanded="false" aria-label="Toggle navigation">
            <span><%= octicon "three-bars" %></span>
        </button>
        <div class="collapse navbar-collapse" id="leagueNav">
            <ul class="navbar-nav">
                <li class="nav-item text-muted">
                    <%= link_to "Home", league_path(@league), method: :get, class: "nav-link" %>
                </li>
                <li class="nav-item text-muted">
                    <%= link_to "Leaders", leaders_league_path(@league), method: :get, class: "nav-link" %>
                </li>
                <li class="nav-item text-muted">
                    <%= link_to "Standings", standings_league_path(@league), method: :get, class: "nav-link" %>
                </li>
                <li class="nav-item text-muted">
                    <%= link_to "Players", players_league_path(@league), method: :get, class: "nav-link" %>
                </li>
                <li class="nav-item text-muted">
                    <%= link_to "Schedule", schedule_league_path(@league), method: :get, class: "nav-link" %>
                </li>
                <li class="nav-item font-weight-bold">
                    <%= link_to "Transactions", transactions_league_path(@league), method: :get, class: "nav-link" %>
                </li>
                <li class="nav-item text-muted">
                    <%= link_to "Signups", signups_league_path(@league), method: :get, class: "nav-link" %>
                </li>
                <li class="nav-item text-muted">
                    <%= link_to "History", history_league_path(@league), method: :get, class: "nav-link" %>
                </li>
            </ul>
        </div>
    </nav>

    <% if current_user.admin || current_user.captain?(@season) || current_user.stat_admin %>
        <%= link_to submit_transaction_league_season_path(@league, @season), method: :get do %>
            <div class="btn btn-outline-dark mt-3" style="cursor: pointer;">
                Submit transaction
            </div>
        <% end %>
    <% end %>

    <% if current_user.admin %>
        <div class="card mt-3">
            <div class="card-header text-center">
                Pending Trades
            </div>
            
            <div class="card-body">
                <% if @pending_trades.any? %>
                    <% @pending_trades.each do |trade| %>
                        <div class="row mt-2 p-3 border border-light border-left-0 border-right-0 justify-content-center">
                            <% trade.movements.group_by{|m| m.destination_id}.each do |key, value| %>
                                <div class="col-6 col-lg-3">
                                    <div class="card">
                                        <div class="card-header">
                                            <img class="img-responsive" width="30" src="<%= get_logo(@season.teams.find(key)) %>"/> <%= @season.teams.find(key).name %>
                                        </div>
                                        <% value.each do |v| %>
                                            <div class="row">
                                                <div class="col-12 p-2">
                                                    <img class="mr-1 img-responsive" width="25" style="opacity: 0.5;" src="<%= get_logo(@season.teams.find(v.origin_id))%>"/> <img class="mr-1 img-responsive rounded-circle" width="30" src="<%= get_avatar(v.team_player.player) %>"/> <%= v.team_player.player.user_name %> - $<%= v.team_player.salary %>
                                                </div>
                                            </div>
                                        <% end %>
                                    </div>
                                </div>
                            <% end %>

                            <div class="col-12 mt-2 justify-content-center">
                                <%= link_to approve_transaction_league_season_path(@league, @season, trade_id: trade.id), method: :post do %>
                                    <button class="btn btn-outline-dark" style="cursor: pointer;">Approve Transaction</button>
                                <% end %>
                                <%= link_to decline_transaction_league_season_path(@league, @season, trade_id: trade.id), method: :post do %>
                                    <button class="btn btn-outline-dark" style="cursor: pointer;">Decline Transaction</button>
                                <% end %>
                            </div>
                        </div>
                        
                    <% end %>
                <% else %>
                    <div class="card-text">
                        No pending transactions
                    </div>
                <% end %>
            </div>
        </div>
    <% end %>

    <div class="card mt-3 mb-3">
        <div class="card-header text-center">Approved Transactions</div>
        <div class="card-body">
            <% if @approved_trades.any? %>
                <% @approved_trades.each do |trade| %>
                    <div class="row mt-2 p-3 border border-light border-left-0 border-right-0 justify-content-center">
                        <% trade.movements.group_by{|m| m.destination_id}.each do |key, value| %>
                            <div class="col-6 col-lg-3">
                                <div class="card">
                                    <div class="card-header">
                                        <img class="img-responsive" width="30" src="<%= get_logo(@season.teams.find(key)) %>"/> <%= @season.teams.find(key).name %>
                                    </div>
                                    <% value.each do |v| %>
                                        <div class="row">
                                            <div class="col-12 p-2">
                                                <img class="mr-1 img-responsive" width="25" style="opacity: 0.5;" src="<%= get_logo(@season.teams.find(v.origin_id))%>"/> <img class="mr-1 img-responsive rounded-circle" width="30" src="<%= get_avatar(v.team_player.player) %>"/> <%= v.team_player.player.user_name %> - $<%= v.team_player.salary %>
                                            </div>
                                        </div>
                                    <% end %>
                                </div>
                            </div>
                        <% end %>
                    </div>
                <% end %>
            <% else %>
                <div class="card-text">
                    No transactions
                </div>
            <% end %>
        </div>
    </div>
</div>