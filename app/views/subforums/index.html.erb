<%= render 'games/carousel', league: @main_league, season: @season, recent_games: @recent_games %>

<div class="card  border-accent">
    <div class="card-body">
        <div class="row">
            <div class="col-12 col-lg-4 text-center">
                <span id="timer"></span>
                <script>
                    // Set the date we're counting down to
                    var countDownDate = new Date("Oct 16, 2017 20:00:00").getTime();

                    Number.prototype.zeroPad = function(length) {
                        length = length || 2; // defaults to 2 if no parameter is passed
                        return (new Array(length).join('0')+this).slice(length*-1);
                    };

                    // Update the count down every 1 second
                    var x = setInterval(function() {

                    // Get todays date and time
                    var now = new Date().getTime();

                    // Find the distance between now an the count down date
                    var distance = countDownDate - now;

                    // Time calculations for days, hours, minutes and seconds
                    var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                    var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                    var seconds = Math.floor((distance % (1000 * 60)) / 1000);

                    // Display the result in the element with id="demo"
                    document.getElementById("timer").innerHTML = "<strong>" + days.zeroPad() + ":" + hours.zeroPad() + ":"
                    + minutes.zeroPad() + ":" + seconds.zeroPad() + "</strong>" + " until the draft.";

                    // If the count down is finished, write some text 
                    if (distance < 0) {
                        clearInterval(x);
                        document.getElementById("timer").innerHTML = "EXPIRED";
                    }
                    }, 1000);
                    </script>
            </div>
            <div class="col-12 col-lg-4 text-center">
                Draft Date: <strong>Monday, October 16th</strong>
            </div>
            <div class="col-12 col-lg-4 text-center">
                Season Start: <strong>Sunday, October 22nd</strong>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12 col-lg-8 mb-4">
        <div class="text-left mb-2 border border-accent border-top-0 border-left-0 border-right-0">
            <h2>Chat</h2>
        </div>

        <div id="chatbox">
            <%= render 'chat_boxes/chatbox', chat_box: @chatbox, messages: @messages, message: Message.new %>
        </div>

        <div class="text-left mt-4 mb-2 border border-accent border-top-0 border-left-0 border-right-0">
            <h2>Forum</h2>
        </div>
        
        <% @subforums.each do |subforum| %>
            <%= render 'preview', subforum: subforum %>
        <% end %>
    </div>

    <div class="col-12 col-lg-4">
        <div class="text-left mb-2 border border-accent border-top-0 border-left-0 border-right-0">
            <h2>Leagues</h2>
        </div>

        <% @leagues.each do |league| %>
            <%= link_to league, method: :get do %>
                <div class="card border-accent">
                    <div class="card-body">
                        <%= league.name %> - <%= league.current_season.title %>
                    </div>
                </div>
            <% end %>
        <% end %>

        <%= link_to signups_league_path(@main_league), method: :get do %>
            <div class="card  mt-4 border-accent">
                <div class="card-body">
                     Who's signed up?
                </div>
            </div>
        <% end %>

        <%= link_to pages_protected_players_path, method: :get do %>
            <div class="card  mt-4 border-accent">
                <div class="card-body">
                    Current RFAs and Keepers
                </div>
            </div>
        <% end %>

        <% if !current_user.signed_up_for(@season) %>
            <%= link_to signup_league_season_path(@main_league, @season), class: "card  mt-4 bg-accent border-accent text-white mb-3", method: :get do %>
                <div class="card-body">
                    Waiver for Season 33
                </div>
            <% end %>
        <% end %>

        <%= link_to pages_player_rankings_path, class:"card mt-4  border-accent", method: :get do %>
            <div class="card-body justify-content-center text-center">
                <img class="img-fluid" src="<%= asset_path("PlayerRatings.png") %>"/>
            </div>
        <% end %>

        <div class="card mt-4  border-accent">
            <div class="card-body">
                <div class="card-title">
                    Online members
                </div>
                <div class="card-text">
                    <% User.online.each do |u| %>
                        <span class="text-primary"><%= link_to u.user_name, profile_path(u.user_name), method: :get, class: "card-link" %></span>, 
                    <% end %>
                </div>
            </div>
        </div>

        <div class="text-left mt-4 mb-2 border border-accent border-top-0 border-left-0 border-right-0">
            <h2>Recent Posts</h2>
        </div>

        <% @recent_posts.each do |post| %>
            <%= link_to subforum_post_path(post.subforum, post), method: :get do %>
                <div class="card border-accent mb-1">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-3 text-center align-self-center">
                                <img class="img-responsive rounded-circle" style="max-height: 100%; max-width: 100%;" src=<%= get_avatar(post.most_recent.user) %>/>
                            </div>
                            <div class="col-9 text-left">
                                <div>
                                    <%= post.title %>
                                </div>
                                <div>
                                    <span class="text-muted"><%= (post.updated_at - 4.hours).strftime("%b %d at %I:%M %p") %></span>
                                </div>
                                <div>
                                    <span class="text-muted"><%= post.subforum.title %></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            <% end %>
        <% end %>
    </div>
</div>

<%= javascript_pack_tag 'chat/new-message' %>